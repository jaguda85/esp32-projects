---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const projects = (await getCollection('projects')).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

const getDifficultyClass = (difficulty: string) => {
  const map: Record<string, string> = {
    'Åatwy': 'difficulty-easy',
    'Åšredni': 'difficulty-medium',
    'Trudny': 'difficulty-hard'
  };
  return map[difficulty] || 'difficulty-medium';
};

const getProjectUrl = (slug: string) => {
  const base = import.meta.env.BASE_URL || '/';
  const baseWithSlash = base.endsWith('/') ? base : `${base}/`;
  return `${baseWithSlash}projects/${slug}`;
};

const getAssetPath = (path: string) => {
  const base = import.meta.env.BASE_URL || '/';
  const baseWithSlash = base.endsWith('/') ? base : `${base}/`;
  return `${baseWithSlash}${path}`;
};
---

<Layout title="Moje projekty ESP32">
  <!-- SEKCJA PROFILU -->
  <div class="profile-section">
    <img 
      src={getAssetPath('images/jaguda-logo.png')}
      alt="Jaguda Logo" 
      class="profile-avatar"
    />
    <h1 class="profile-name">Jaguda</h1>
    <a href="https://github.com/jaguda85" target="_blank" rel="noopener noreferrer" class="github-link">
      <span class="github-icon">âš¡</span>
      <span>GitHub Profile</span>
      <span class="github-icon">ðŸš€</span>
    </a>
  </div>

  <!-- SEPARATOR -->
  <div style="height: 2px; background: linear-gradient(90deg, transparent, var(--primary), transparent); margin: 50px 0;"></div>

  <!-- NAGÅÃ“WEK PROJEKTÃ“W -->
  <h1 style="text-align: center; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 10px; font-weight: 800; font-size: 2rem;">
    âš¡ Moje Projekty âš¡
  </h1>
  <p style="text-align: center; color: var(--text-light); margin-bottom: 40px; font-size: 1rem;">
    Elektronika â€¢ IoT â€¢ ESP32
  </p>
  
  <!-- SIATKA PROJEKTÃ“W -->
  <div class="project-grid">
    {projects.map((project) => (
      <a href={getProjectUrl(project.slug)} class="project-card">
        <img 
          src={project.data.mainImage} 
          alt={project.data.title}
          loading="lazy"
        />
        <div class="project-card-content">
          <h2>{project.data.title}</h2>
          <p>{project.data.description}</p>
          
          {project.data.difficulty && (
            <p class={`difficulty-badge ${getDifficultyClass(project.data.difficulty)}`} style="margin: 12px 0;">
              {project.data.difficulty}
            </p>
          )}
          
          {project.data.tags && (
            <div class="tags">
              {project.data.tags.map((tag) => (
                <span class="tag">{tag}</span>
              ))}
            </div>
          )}
        </div>
      </a>
    ))}
  </div>
  
  {projects.length === 0 && (
    <div style="text-align: center; padding: 80px 20px; background: var(--bg-card); border-radius: 15px; border: 1px solid var(--border);">
      <p style="color: var(--text-light); font-size: 1.2rem; margin-bottom: 15px;">
        ðŸš€ Brak projektÃ³w
      </p>
      <p style="color: var(--text-muted); font-size: 0.95rem;">
        Dodaj swÃ³j pierwszy projekt w katalogu <code style="background: var(--code-bg); padding: 3px 8px; border-radius: 5px;">src/content/projects/</code>
      </p>
    </div>
  )}
</Layout>